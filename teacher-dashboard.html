<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù… - Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="index.html" class="nav-link"><h2>ğŸ“ Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h2></a>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="teachers.html" class="nav-link">Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</a>
                <a href="lessons.html" class="nav-link">Ø§Ù„Ø¯Ø±ÙˆØ³</a>
            </div>
            <div class="nav-user">
                <div class="user-dropdown">
                    <button class="user-name-btn" id="userName" onclick="toggleUserMenu()"></button>
                    <div class="user-menu" id="userMenu">
                        <a href="teacher-dashboard.html" class="user-menu-item nav-link active">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                        <button onclick="openSettings()" class="user-menu-item">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        <button onclick="logout()" class="user-menu-item logout-btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                        <div class="user-email" id="userEmail">example@gmail.com</div>
                    </div>
                </div>
            </div>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
        </div>
    </nav>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main style="padding: 2rem 0; min-height: 80vh;">
        <div class="container">
            <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <h1 style="font-size: 2.5rem; font-weight: 700; color: #1F2937; margin-bottom: 0.5rem;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…</h1>
                    <p style="color: #6B7280;" id="welcomeMessage">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
                </div>
                <button onclick="toggleAddForm()" class="btn btn-secondary btn-large" id="addLessonBtn">
                    â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“š</div>
                    <div class="stat-number" id="totalLessons">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø±ÙˆØ³</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘ï¸</div>
                    <div class="stat-number" id="totalViews">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-number">247</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â­</div>
                    <div class="stat-number">4.9</div>
                    <div class="stat-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</div>
                </div>
            </div>

            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ -->
            <div id="addLessonForm" class="hidden teacher-dashboard-add-form" style="padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); margin-bottom: 3rem;">
                <h2 style="font-size: 1.75rem; font-weight: 600; margin-bottom: 1.5rem; color: #1F2937;">Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h2>
                
                <form id="lessonForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="title" class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³ *</label>
                            <input type="text" id="title" name="title" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³" required>
                        </div>
                        <div class="form-group">
                            <label for="subject" class="form-label">Ø§Ù„Ù…Ø§Ø¯Ø© *</label>
                            <select id="subject" name="subject" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                                <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                                <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
                                <option value="Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
                                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                                <option value="Ø§Ù„ØªØ§Ø±ÙŠØ®">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                                <option value="Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§">Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                                <option value="Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©">Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</option>
                                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description" class="form-label">ÙˆØµÙ Ø§Ù„Ø¯Ø±Ø³ *</label>
                        <textarea id="description" name="description" class="form-textarea" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ù„Ø¯Ø±Ø³..." rows="4" required></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="youtubeUrl" class="form-label">Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ YouTube</label>
                            <input type="url" id="youtubeUrl" name="youtubeUrl" class="form-input" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                        <div class="form-group">
                            <label for="pdfUrl" class="form-label">Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF</label>
                            <input type="url" id="pdfUrl" name="pdfUrl" class="form-input" placeholder="https://drive.google.com/...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="duration" class="form-label">Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø³ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                        <input type="number" id="duration" name="duration" class="form-input" placeholder="45" min="1" max="300">
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³</button>
                        <button type="button" onclick="toggleAddForm()" class="btn btn-outline">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </form>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø¯Ø±ÙˆØ³ÙŠ -->
            <div class="teacher-dashboard-lessons-section" style="padding: 2rem; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);">
                <h2 style="font-size: 1.75rem; font-weight: 600; margin-bottom: 1.5rem; color: #1F2937;">Ø¯Ø±ÙˆØ³ÙŠ</h2>
                
                <div id="myLessonsGrid">
                    <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/main.js"></script>
    <script>
        let showingAddForm = false;

        document.addEventListener('DOMContentLoaded', async function() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹Ù„Ù…
            await checkTeacherAccess();
            await loadMyLessons();
        });

        async function checkTeacherAccess() {
            try {
                const response = await fetch('/api/me');
                if (!response.ok) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const user = await response.json();
                if (user.userType !== 'teacher') {
                    alert('Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙ‚Ø·');
                    window.location.href = 'index.html';
                    return;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('userName').textContent = `${user.firstName} ${user.lastName}`;
                document.getElementById('welcomeMessage').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${user.firstName} ${user.lastName}`;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:', error);
                window.location.href = 'login.html';
            }
        }

        async function loadMyLessons() {
            try {
                const response = await fetch('/api/my-lessons');
                if (!response.ok) {
                    throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³');
                }
                
                const lessons = await response.json();
                updateStats(lessons);
                displayMyLessons(lessons);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³:', error);
                document.getElementById('myLessonsGrid').innerHTML = `
                    <div class="error">
                        <h3>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        <p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¯Ø±ÙˆØ³Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                    </div>
                `;
            }
        }

        function updateStats(lessons) {
            const totalLessons = lessons.length;
            const totalViews = lessons.reduce((sum, lesson) => sum + (lesson.views || 0), 0);
            
            document.getElementById('totalLessons').textContent = totalLessons;
            document.getElementById('totalViews').textContent = formatArabicNumber(totalViews);
        }

        function displayMyLessons(lessons) {
            const myLessonsGrid = document.getElementById('myLessonsGrid');
            
            if (lessons.length === 0) {
                myLessonsGrid.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“š</div>
                        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¯Ø±Ø³ Ù„Ùƒ Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³.</p>
                        <button onclick="toggleAddForm()" class="btn btn-primary" style="margin-top: 1rem;">Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</button>
                    </div>
                `;
                return;
            }

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            const sortedLessons = lessons.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            myLessonsGrid.innerHTML = `
                <div class="lessons-dashboard-grid" style="display: grid; gap: 1.5rem;">
                    ${sortedLessons.map(lesson => `
                        <div class="lesson-dashboard-card" style="border-radius: 12px; padding: 1.5rem; display: flex; gap: 1.5rem; align-items: flex-start;">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #2563EB, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; flex-shrink: 0;">
                                ${lesson.youtubeUrl ? 'ğŸ“¹' : 'ğŸ“„'}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #1F2937; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${lesson.title}</h3>
                                <p style="color: #6B7280; margin-bottom: 0.5rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${lesson.description}</p>
                                <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: #6B7280; flex-wrap: wrap;">
                                    <span>ğŸ“š ${lesson.subject}</span>
                                    <span>ğŸ‘ï¸ ${lesson.views || 0} Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                                    <span>ğŸ‘ ${lesson.likes || 0} Ø¥Ø¹Ø¬Ø§Ø¨</span>
                                    <span>ğŸ“… ${formatArabicDate(lesson.createdAt)}</span>
                                </div>
                            </div>
                            <div class="lesson-actions-buttons" style="display: flex; flex-direction: column; gap: 0.5rem; flex-shrink: 0;">
                                <a href="lesson-view.html?id=${lesson.id}" class="btn btn-outline" style="padding: 6px 12px; font-size: 0.875rem; white-space: nowrap;">ğŸ‘ï¸ Ø¹Ø±Ø¶</a>
                                <button onclick="editLesson(${lesson.id})" class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.875rem; white-space: nowrap;">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                                <button onclick="deleteLesson(${lesson.id})" class="btn btn-danger" style="padding: 6px 12px; font-size: 0.875rem; white-space: nowrap;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function toggleAddForm() {
            const form = document.getElementById('addLessonForm');
            const btn = document.getElementById('addLessonBtn');
            
            showingAddForm = !showingAddForm;
            
            if (showingAddForm) {
                form.classList.remove('hidden');
                btn.textContent = 'âŒ Ø¥Ù„ØºØ§Ø¡';
                form.scrollIntoView({ behavior: 'smooth' });
            } else {
                form.classList.add('hidden');
                btn.textContent = 'â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('lessonForm').reset();
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³
        document.getElementById('lessonForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const lessonData = {
                title: formData.get('title'),
                description: formData.get('description'),
                subject: formData.get('subject'),
                youtubeUrl: formData.get('youtubeUrl') || null,
                pdfUrl: formData.get('pdfUrl') || null,
                duration: parseInt(formData.get('duration')) || 0
            };
            
            try {
                const response = await fetch('/api/lessons', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(lessonData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
                    const successMsg = document.createElement('div');
                    successMsg.className = 'form-success';
                    successMsg.textContent = 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­!';
                    successMsg.style.position = 'fixed';
                    successMsg.style.top = '20px';
                    successMsg.style.right = '20px';
                    successMsg.style.zIndex = '9999';
                    document.body.appendChild(successMsg);
                    
                    setTimeout(() => {
                        document.body.removeChild(successMsg);
                    }, 3000);
                    
                    event.target.reset();
                    toggleAddForm();
                    await loadMyLessons();
                } else {
                    alert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            }
        });

        async function editLesson(lessonId) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯Ø±Ø³ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©
            const response = await fetch('/api/my-lessons');
            const lessons = await response.json();
            const lesson = lessons.find(l => l.id === lessonId);
            
            if (!lesson) {
                alert('Ø§Ù„Ø¯Ø±Ø³ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            document.getElementById('title').value = lesson.title;
            document.getElementById('subject').value = lesson.subject;
            document.getElementById('description').value = lesson.description;
            document.getElementById('youtubeUrl').value = lesson.youtubeUrl || '';
            document.getElementById('pdfUrl').value = lesson.pdfUrl || '';
            document.getElementById('duration').value = lesson.duration || '';
            
            // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const form = document.getElementById('lessonForm');
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = 'ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø³';
            submitBtn.onclick = () => updateLesson(lessonId);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            showingAddForm = false;
            toggleAddForm();
        }
        
        async function updateLesson(lessonId) {
            const form = document.getElementById('lessonForm');
            const formData = new FormData(form);
            
            const lessonData = {
                title: formData.get('title'),
                description: formData.get('description'),
                subject: formData.get('subject'),
                youtubeUrl: formData.get('youtubeUrl') || null,
                pdfUrl: formData.get('pdfUrl') || null,
                duration: parseInt(formData.get('duration')) || 0
            };
            
            try {
                const response = await fetch(`/api/lessons/${lessonId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(lessonData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­!');
                    form.reset();
                    resetFormToAddMode();
                    toggleAddForm();
                    await loadMyLessons();
                } else {
                    alert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø³');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø³:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            }
        }
        
        function resetFormToAddMode() {
            const form = document.getElementById('lessonForm');
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³';
            submitBtn.onclick = null;
        }

        async function deleteLesson(lessonId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/lessons/${lessonId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­');
                    await loadMyLessons();
                } else {
                    alert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            }
        }
    </script>
</body>
</html>